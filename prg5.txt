CREATE TABLE movie_log(MOVIE_ID STRING,MOVIE_TITLE STRING,USER_ID STRING,RATINGS 
FLOAT,GENRE_ID STRING,RECOMMENDED STRING,ACTIVITY INT) ROW FORMAT DELIMITED FIELDS TERM
INATED BY ',' STORED AS TEXTFILE;

LOAD DATA LOCAL INPATH 'p5.csv' INTO TABLE movie_log;


SELECT activity, CASE WHEN RECOMMENDED = 'Y' THEN 1 WHEN RECOMMENDED = 'N' THEN 0
 ELSE NULL END AS RECOMMENDED_INT, GENRE_ID FROM movie_log WHERE activity IN ('START_MO
VIE', 'BROWSE_MOVIE', 'COMPLETED_MOVIE', 'RATE_MOVIE') AND GENRE_ID IS NOT NULL LIMIT 2
5;

WITH MostRecentRatings AS ( SELECT USER_ID, MOVIE_ID, RATINGS, RECOMMENDED, ROW_
NUMBER() OVER (PARTITION BY MOVIE_ID) AS rn FROM movie_log WHERE RATINGS IS NOT NULL ) 
SELECT USER_ID, MOVIE_ID, CASE WHEN RECOMMENDED = 'Y' THEN 1 WHEN RECOMMENDED = 'N' THE
N 0 ELSE NULL END AS RECOMMENDED_INT, ratings AS most_recent_rating FROM MostRecentRati
ngs WHERE rn = 1;


WITH MostRecentRatings AS (SELECT USER_ID, MOVIE_ID,MOVIE_TITLE,RATINGS,RECOMMEND
ED, ROW_NUMBER() OVER (PARTITION BY MOVIE_ID) AS rn FROM movie_log WHERE ratings IS NOT
 NULL ) SELECT USER_ID, MOVIE_ID, MOVIE_TITLE, CASE WHEN RECOMMENDED = 'Y' THEN 1 WHEN 
RECOMMENDED = 'N' THEN 0 ELSE NULL END AS RECOMMENDED_INT, RATINGS AS most_recent_ratin
g FROM MostRecentRatings WHERE rn = 1 LIMIT 5;                                                                      